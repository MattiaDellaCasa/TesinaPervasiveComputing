/Library/Frameworks/Python.framework/Versions/3.9/lib/python3.9/site-packages/google/cloud/firestore_v1/base_collection.py:304: UserWarning: Detected filter using positional arguments. Prefer using the 'filter' keyword argument instead.
  return query.where(field_path, op_string, value)
/Users/fabio/Desktop/progetto-mining/mining-monitor/main.py:79: DeprecationWarning: Callback API version 1 is deprecated, update to latest version
  self.mqtt_client = mqtt.Client()
Settings caricati: soglia=1.5
Connesso a Firestore
Eliminati 2 documenti vecchi da Firestore
Client MQTT configurato per localhost:1883
ML Predictor non disponibile: __init__() got an unexpected keyword argument 'db'
Avvio server Flask su 0.0.0.0:8080
Soglia allerta attuale: 1.5%
Email notifiche: abilitato
Connesso al broker MQTT
 * Serving Flask app 'main' (lazy loading)
 * Environment: development
 * Debug mode: on
WARNING:werkzeug: * Running on all addresses.
   WARNING: This is a development server. Do not use it in a production deployment.
INFO:werkzeug: * Running on http://192.168.1.29:8080/ (Press CTRL+C to quit)
INFO:werkzeug:127.0.0.1 - - [13/Sep/2025 17:29:09] "GET / HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [13/Sep/2025 17:29:15] "GET /login HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [13/Sep/2025 17:29:21] "[32mPOST /login HTTP/1.1[0m" 302 -
INFO:werkzeug:127.0.0.1 - - [13/Sep/2025 17:29:22] "GET /dashboard HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [13/Sep/2025 17:29:22] "GET /api/charts/realtime HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [13/Sep/2025 17:29:24] "GET /settings HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [13/Sep/2025 17:29:25] "GET /api/settings/current HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [13/Sep/2025 17:29:25] "POST /api/settings/email HTTP/1.1" 200 -
ERROR:email_notifications:Errore invio email a mattia1.dellacasa@gmail.com: Connection unexpectedly closed
ERROR:email_notifications:Errore invio email a mattia1.dellacasa@gmail.com: Connection unexpectedly closed
ERROR:email_notifications:Errore invio email a fabiofiorini96@gmail.com: Connection unexpectedly closed
INFO:werkzeug:127.0.0.1 - - [13/Sep/2025 17:29:51] "POST /api/settings/test-email HTTP/1.1" 200 -
ERROR:email_notifications:Errore invio email a mattia1.dellacasa@gmail.com: Connection unexpectedly closed
ERROR:email_notifications:Errore invio email a fabiofiorini96@gmail.com: Connection unexpectedly closed
INFO:werkzeug:127.0.0.1 - - [13/Sep/2025 17:30:00] "POST /api/settings/test-email HTTP/1.1" 200 -
ERROR:email_notifications:Errore invio email a fabiofiorini96@gmail.com: Connection unexpectedly closed
INFO:werkzeug:127.0.0.1 - - [13/Sep/2025 17:30:05] "POST /api/settings/test-email HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [13/Sep/2025 17:30:48] "POST /api/settings/threshold HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [13/Sep/2025 17:30:49] "GET /predictions HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [13/Sep/2025 17:30:49] "GET /api/settings/current HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [13/Sep/2025 17:30:49] "GET /api/settings/current HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [13/Sep/2025 17:30:49] "GET /api/charts/prediction?hours=1 HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [13/Sep/2025 17:30:51] "GET /api/settings/current HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [13/Sep/2025 17:30:51] "GET /api/charts/prediction?hours=1 HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [13/Sep/2025 17:30:54] "GET /api/charts/prediction?hours=4 HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [13/Sep/2025 17:30:55] "GET /api/settings/current HTTP/1.1" 200 -
Ricevuti dati: riga 0
Ricevuti dati: riga 1
Ricevuti dati: riga 2
Ricevuti dati: riga 3
Caricati 4 campioni da Firestore in ordine cronologico di invio
Range row_index: da 0 a 3
DEBUG: latest_data = % Silica Concentrate                                  1.31
Ore Pulp Density                                      1.74
Amina Flow                                         568.665
Flotation Column 07 Air Flow                       251.147
date                                   2017-03-10 01:00:00
Flotation Column 03 Air Flow                       250.049
Flotation Column 02 Air Flow                       254.487
% Iron Feed                                           55.2
Ore Pulp Flow                                      397.939
Flotation Column 03 Level                          442.865
Flotation Column 07 Level                          427.669
Flotation Column 01 Level                          452.441
Flotation Column 04 Level                           446.21
Flotation Column 01 Air Flow                       249.917
% Silica Feed                                        16.98
Flotation Column 02 Level                          458.165
Flotation Column 05 Level                          471.411
Flotation Column 04 Air Flow                       295.096
Flotation Column 06 Air Flow                       250.422
Flotation Column 05 Air Flow                         306.4
Starch Flow                                        3047.36
% Iron Concentrate                                   66.91
Flotation Column 06 Level                           437.69
Ore Pulp pH                                        10.0689
timestamp                       2025-09-13 17:29:20.711979
row_index                                                3
doc_id                                kZWP57BZHC5Ky30Fykp8
Name: 3, dtype: object
DEBUG: % Silica Concentrate = 1.31
DEBUG: stats = {'current_silica': 1.31, 'avg_silica': 1.31, 'std_silica': 0.0, 'max_silica': 1.31, 'min_silica': 1.31, 'current_ph': 10.0689, 'current_iron': 55.2, 'data_points': 4, 'last_row_index': 3, 'current_alerts': 0, 'alert_threshold': 4.0, 'status': 'CLOUD_DATA_OK'}
Ricevuti dati: riga 4
Ricevuti dati: riga 5
Settings salvati: soglia=1.5
Ricevuti dati: riga 6
Ricevuti dati: riga 7
Ricevuti dati: riga 8
Ricevuti dati: riga 9
Ricevuti dati: riga 10
Ricevuti dati: riga 11
Ricevuti dati: riga 12
Ricevuti dati: riga 13
Ricevuti dati: riga 14
Ricevuti dati: riga 15
Ricevuti dati: riga 16
Ricevuti dati: riga 17
Ricevuti dati: riga 18
Ricevuti dati: riga 19
Ricevuti dati: riga 20
Ricevuti dati: riga 21
Ricevuti dati: riga 22
Ricevuti dati: riga 23
Ricevuti dati: riga 24
Ricevuti dati: riga 25
Ricevuti dati: riga 26
Ricevuti dati: riga 27
Ricevuti dati: riga 28
Ricevuti dati: riga 29
Ricevuti dati: riga 30
Ricevuti dati: riga 31
Ricevuti dati: riga 32
Ricevuti dati: riga 33
Ricevuti dati: riga 34
Ricevuti dati: riga 35
Ricevuti dati: riga 36
Ricevuti dati: riga 37
Ricevuti dati: riga 38
Ricevuti dati: riga 39
Ricevuti dati: riga 40
Ricevuti dati: riga 41
Ricevuti dati: riga 42
Ricevuti dati: riga 43
Ricevuti dati: riga 44
Ricevuti dati: riga 45
Ricevuti dati: riga 46
Settings salvati: soglia=1.5
Soglia allerta aggiornata a: 1.5%
Ricevuti dati: riga 47
DEBUG PREDICTION: Avvio creazione grafici predizioni per 1 ore
Caricati 48 campioni da Firestore in ordine cronologico di invio
Range row_index: da 0 a 47
DEBUG PREDICTION: Caricati 48 campioni dal cloud
DEBUG PREDICTION: Ultimo row_index: 47, Soglia: 1.5
DEBUG PREDICTION: Genero 3 predizioni future
DEBUG PREDICTION: Predizione fallback per indice 48: 1.1543769160730137
DEBUG PREDICTION: Predizione fallback per indice 49: 1.2164669486384394
DEBUG PREDICTION: Predizione fallback per indice 50: 1.1339010982996744
DEBUG PREDICTION: Creato DataFrame predizioni con 3 righe
DEBUG PREDICTION: Allerte previste: 0/3 (soglia: 1.5%)
DEBUG PREDICTION: Aggiungo 48 dati storici al grafico
DEBUG PREDICTION: Aggiungo 3 predizioni al grafico
DEBUG PREDICTION: Statistiche predizioni: {'avg_prediction': 1.1682483210037093, 'max_prediction': 1.2164669486384394, 'min_prediction': 1.1339010982996744, 'alerts_predicted': 0, 'avg_confidence': 90.0, 'prediction_horizon': '3 righe future', 'based_on_cloud_data': True, 'last_real_value': 1.31, 'last_row_index': 47, 'alert_threshold': 1.5, 'data_source': 'CLOUD_ONLY'}
DEBUG PREDICTION: Conversione JSON del grafico completata
DEBUG PREDICTION: Ritorno risultati completi
Ricevuti dati: riga 48
DEBUG PREDICTION: Avvio creazione grafici predizioni per 1 ore
Caricati 49 campioni da Firestore in ordine cronologico di invio
Range row_index: da 0 a 48
DEBUG PREDICTION: Caricati 49 campioni dal cloud
DEBUG PREDICTION: Ultimo row_index: 48, Soglia: 1.5
DEBUG PREDICTION: Genero 3 predizioni future
DEBUG PREDICTION: Predizione fallback per indice 49: 1.0811453700226348
DEBUG PREDICTION: Predizione fallback per indice 50: 1.5194514593444184
DEBUG PREDICTION: Predizione fallback per indice 51: 1.22004339272496
DEBUG PREDICTION: Creato DataFrame predizioni con 3 righe
DEBUG PREDICTION: Allerte previste: 1/3 (soglia: 1.5%)
DEBUG PREDICTION: Aggiungo 49 dati storici al grafico
DEBUG PREDICTION: Aggiungo 3 predizioni al grafico
DEBUG PREDICTION: Statistiche predizioni: {'avg_prediction': 1.2735467406973378, 'max_prediction': 1.5194514593444184, 'min_prediction': 1.0811453700226348, 'alerts_predicted': 1, 'avg_confidence': 90.0, 'prediction_horizon': '3 righe future', 'based_on_cloud_data': True, 'last_real_value': 1.31, 'last_row_index': 48, 'alert_threshold': 1.5, 'data_source': 'CLOUD_ONLY'}
DEBUG PREDICTION: Conversione JSON del grafico completata
DEBUG PREDICTION: Ritorno risultati completi
Ricevuti dati: riga 49
DEBUG PREDICTION: Avvio creazione grafici predizioni per 4 ore
Caricati 50 campioni da Firestore in ordine cronologico di invio
Range row_index: da 0 a 49
DEBUG PREDICTION: Caricati 50 campioni dal cloud
DEBUG PREDICTION: Ultimo row_index: 49, Soglia: 1.5
DEBUG PREDICTION: Genero 12 predizioni future
DEBUG PREDICTION: Predizione fallback per indice 50: 1.3598035227577958
DEBUG PREDICTION: Predizione fallback per indice 51: 0.9332573676240623
DEBUG PREDICTION: Predizione fallback per indice 52: 1.455169396979259
DEBUG PREDICTION: Predizione fallback per indice 53: 1.4336989829306952
DEBUG PREDICTION: Predizione fallback per indice 54: 1.2794643771531586
DEBUG PREDICTION: Predizione fallback per indice 55: 1.1475888142089052
DEBUG PREDICTION: Predizione fallback per indice 56: 1.022540483936465
DEBUG PREDICTION: Predizione fallback per indice 57: 1.367170229853269
DEBUG PREDICTION: Predizione fallback per indice 58: 0.9648850213103293
DEBUG PREDICTION: Predizione fallback per indice 59: 0.9772810344026752
DEBUG PREDICTION: Predizione fallback per indice 60: 1.1377629076284046
DEBUG PREDICTION: Predizione fallback per indice 61: 0.9264133991638167
DEBUG PREDICTION: Creato DataFrame predizioni con 12 righe
DEBUG PREDICTION: Allerte previste: 0/12 (soglia: 1.5%)
DEBUG PREDICTION: Aggiungo 50 dati storici al grafico
DEBUG PREDICTION: Aggiungo 12 predizioni al grafico
DEBUG PREDICTION: Statistiche predizioni: {'avg_prediction': 1.1670862948290697, 'max_prediction': 1.455169396979259, 'min_prediction': 0.9264133991638167, 'alerts_predicted': 0, 'avg_confidence': 53.333333333333336, 'prediction_horizon': '12 righe future', 'based_on_cloud_data': True, 'last_real_value': 1.31, 'last_row_index': 49, 'alert_threshold': 1.5, 'data_source': 'CLOUD_ONLY'}
DEBUG PREDICTION: Conversione JSON del grafico completata
DEBUG PREDICTION: Ritorno risultati completi
Ricevuti dati: riga 50
DEBUG PREDICTION: Avvio creazione grafici predizioni per 4 ore
Caricati 51 campioni da Firestore in ordine cronologico di invio
Range row_index: da 0 a 50
DEBUG PREDICTION: Caricati 51 campioni dal cloud
DEBUG PREDICTION: Ultimo row_index: 50, Soglia: 1.5
DEBUG PREDICTION: Genero 12 predizioni future
DEBUG PREDICTION: Predizione fallback per indice 51: 1.4232252773495326
DEBUG PREDICTION: Predizione fallback per indice 52: 1.2561955629644748
DEBUG PREDICTION: Predizione fallback per indice 53: 1.043143539768686
DEBUG PREDICTION: Predizione fallback per indice 54: 1.3049342875387457
INFO:werkzeug:127.0.0.1 - - [13/Sep/2025 17:30:55] "GET /api/charts/prediction?hours=4 HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [13/Sep/2025 17:30:56] "GET /api/settings/current HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [13/Sep/2025 17:30:56] "GET /api/charts/prediction?hours=4 HTTP/1.1" 200 -
ERROR:email_notifications:Errore invio email a mattia1.dellacasa@gmail.com: Connection unexpectedly closed
ERROR:email_notifications:Errore invio email a mattia1.dellacasa@gmail.com: Connection unexpectedly closed
INFO:werkzeug:127.0.0.1 - - [13/Sep/2025 17:31:19] "GET /api/charts/prediction?hours=4 HTTP/1.1" 200 -
ERROR:email_notifications:Errore invio email a fabiofiorini96@gmail.com: Connection unexpectedly closed
ERROR:email_notifications:Errore invio email a fabiofiorini96@gmail.com: Connection unexpectedly closed
INFO:werkzeug:127.0.0.1 - - [13/Sep/2025 17:31:38] "POST /api/notifications/send-prediction-alert HTTP/1.1" 200 -
